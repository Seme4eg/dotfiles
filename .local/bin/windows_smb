#!/usr/bin/bash

set -e

pass=$(pass work/mg/rdp | head -n1)
user=$(pass work/mg/rdp | grep 'user: ' | cut -d' ' -f 2)
smb_remote=$(pass work/mg/rdp | grep 'smb_path: ' | cut -d' ' -f 2)
smb_local="$HOME/git/work_mg/smb/"

mkdir -p "$smb_local"

if ! nmcli -g name,type con show --active | grep cisco >/dev/null; then
  togglevpn cisco
  sleep 2
fi

sudo mount -t smb3 -o user="$user",pass="$pass",uid=1000,gid=1000 \
  "$smb_remote" "$smb_local"

echo
read -p "Press Enter to continue..."

sudo umount "$smb_local"
