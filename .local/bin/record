#!/usr/bin/env bash

# Convert mp4 to gif
# ffmpeg -i temp.mp4 vid.gif

rec_dir="$HOME/Movies"
[ ! -d "$rec_dir" ] && mkdir "$rec_dir"

filepath="${rec_dir}/rec_$(date +%H-%M-%S)"

# grep first alsa_output, command is taken from wf-recorder man page
get_sink() { pactl list sources | grep -e 'Name.*alsa_output' | head -n1; }

while getopts ":vVpsg" opt; do case $opt in
  v) # default one: vid without system sounds
    say -e 'Recording started'
    wf-recorder -f "${filepath}.mp4"
    ;;
  V) # with system sounds
    say -e 'Recording started'
    wf-recorder --audio="$(get_sink)" -f "${filepath}.mp4"
    ;;
  s) # stop current recording
    # sigint, not sigkill, otherwise no mime type
    pkill -2 record && say -e "Recorded"
    ;;
  # Super inefficient, mp4 records take 2-3 times less space..
  g) # gif version
    wf-recorder -g "$(slurp)" -c gif -r 14 -f "${filepath}.gif"
    ;;
  p | *) # record part of screen - (based on my usage this one is mose frequent)
    wf-recorder -g "$(slurp)" -f "${filepath}.mp4"
    ;;
esac done
