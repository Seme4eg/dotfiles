#!/bin/bash

action=install

while getopts ":ri" Option; do case $Option in
  i) action=install ;;
  r) action=remove ;;
  *) action=install ;;
esac done

awk_install_str='
/^Name/{name=$2}
/^Description/{description=$2}
/^Download Size/{size=$2}
/^Installed Size/{size_i=$2;
print name, "„Äå "size" ‚Üí", size_i" „Äç", description}'

awk_remove_str='
/^Name/{name=$2}
/^Description/{description=$2}
/^Installed Size/{size=$2;
print name, "„Äå "size" „Äç", description}'

case $action in
  "install")
    pkg=$(pacman -Si | awk -F ' : ' "$awk_install_str" | sort -d | \
      rofi -dmenu -i \
      -theme-str '#entry { placeholder: "Install package ..."; }' | \
      awk '{print $1}')

    [ -z "$pkg" ] && exit 0

    sudo pacman -S --noconfirm "$pkg" &&
      say "Installed üì¶ $pkg" || say "Failed to install üì¶ $pkg"
    ;;
  "remove")
    pkg=$(yay -Qi | awk -F ' : ' "$awk_remove_str" | sort -d | \
      rofi -dmenu -i \
      -theme-str '#entry { placeholder: "Remove package ..."; }' | \
      awk '{print $1}')

    [ -z "$pkg" ] && exit 0

    sudo pacman -R --noconfirm "$pkg" &&
      say "Removed üì¶ $pkg" || say "Failed to remove üì¶ $pkg"
    ;;
esac
